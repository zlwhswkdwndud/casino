<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ì•„ì‰ ì›”ë“œ í†µí•© í¬í„¸</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        :root { --pink: #ff79c6; --bg: #0b0e14; --card: #1a1c2c; }
        body { background: var(--bg); color: white; font-family: 'Pretendard', sans-serif; display: flex; margin: 0; }
        nav { width: 220px; background: #000; height: 100vh; padding: 20px; position: fixed; }
        nav button { width: 100%; padding: 15px; margin-bottom: 10px; background: var(--card); border: 1px solid var(--pink); color: white; border-radius: 10px; cursor: pointer; }
        nav button:hover { background: var(--pink); color: black; }
        main { margin-left: 260px; padding: 40px; width: 100%; }
        .card { background: var(--card); padding: 25px; border-radius: 20px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .tab { display: none; } .active { display: block; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: none; background: #282a36; color: white; }
        .reels { display: flex; gap: 15px; margin-bottom: 20px; }
        .reel { width: 100px; height: 100px; background: white; color: black; font-size: 3rem; display: flex; align-items: center; justify-content: center; border-radius: 15px; }
    </style>
</head>
<body>

<nav>
    <h1 style="color:var(--pink); text-align: center;">A-ING</h1>
    <button onclick="showTab('info')">ğŸ“‹ ë‚´ ì •ë³´</button>
    <button onclick="showTab('bank')">ğŸ¦ ì•„ì‰ì€í–‰</button>
    <button onclick="showTab('slot')">ğŸ° ìŠ¬ë¡¯ë¨¸ì‹ </button>
</nav>

<main>
    <div id="tab-info" class="tab active">
        <div class="card">
            <h2>ğŸ’° ìì‚° í˜„í™©</h2>
            <p>ë³´ìœ  ê¸ˆì•¡: <strong style="font-size:1.5rem;">{{ "{:,}".format(user['money']) }}ì›</strong></p>
            <p>ëŒ€ì¶œ ì”ì•¡: <span style="color:var(--pink)">{{ "{:,}".format(user['loan']) }}ì›</span></p>
            <p>í˜„ì¬ ë“±ê¸‰: <span style="color:#f1fa8c">{{ user['grade'] }}</span> (í•œë„: {{ "{:,}".format(GRADE_DATA[user['grade']]['limit']) }}ì›)</p>
        </div>
    </div>

    <div id="tab-bank" class="tab">
        <div class="card">
            <h3>ğŸ’¸ 10% ìˆ˜ìˆ˜ë£Œ ì†¡ê¸ˆ</h3>
            <select id="to_id">
                {% for u in all_users %}{% if u.id != user['id'] %}<option value="{{u.id}}">{{u.name}}</option>{% endif %}{% endfor %}
            </select>
            <input type="number" id="send_amt" placeholder="ë³´ë‚¼ ê¸ˆì•¡">
            <button onclick="bankAction('send')" style="background:var(--pink); color:black; font-weight:bold; border:none; padding:10px; width:100%; cursor:pointer;">ì†¡ê¸ˆí•˜ê¸°</button>
        </div>
        <div class="card">
            <h3>ğŸ¦ ëŒ€ì¶œ ë° ìƒí™˜</h3>
            <input type="number" id="loan_amt" placeholder="ëŒ€ì¶œ/ìƒí™˜ ê¸ˆì•¡">
            <div style="display:flex; gap:10px;">
                <button onclick="bankAction('loan')" style="flex:1">ëŒ€ì¶œ</button>
                <button onclick="bankAction('repay')" style="flex:1; background:#ff5555">ìƒí™˜</button>
            </div>
        </div>
        <div class="card">
            <h3>ğŸ‘‘ ë“±ê¸‰ êµ¬ë§¤</h3>
            <p>ë‹¤ìŒ ë“±ê¸‰: {{ GRADE_DATA[user['grade']]['next'] or 'ìµœê³ ë“±ê¸‰' }}</p>
            <p>ë¹„ìš©: {{ "{:,}".format(GRADE_DATA[user['grade']]['up_cost']) }}ì›</p>
            <button onclick="bankAction('upgrade')">êµ¬ë§¤í•˜ê¸°</button>
        </div>
    </div>

    <div id="tab-slot" class="tab">
        <div class="card">
            <h2>ğŸ° ì•„ì‰ ìŠ¬ë¡¯</h2>
            <div class="reels">
                <div id="r1" class="reel">â“</div>
                <div id="r2" class="reel">â“</div>
                <div id="r3" class="reel">â“</div>
            </div>
            <input type="number" id="slot_bet" value="1000">
            <button onclick="spinSlot()" style="background:#50fa7b; color:black; font-weight:bold; height:50px; border:none; width:100%; border-radius:10px; cursor:pointer;">ëŒë¦¬ê¸°!</button>
        </div>
    </div>
</main>

<script>
    function showTab(id) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('tab-' + id).classList.add('active');
    }

    async function bankAction(action) {
        const amt = document.getElementById(action === 'upgrade' ? '' : action.split('_')[0] + '_amt')?.value;
        const to_id = document.getElementById('to_id')?.value;
        try {
            const res = await axios.post('/api/bank', { action, amount: amt, to_id });
            alert(res.data.msg); location.reload();
        } catch(e) { alert(e.response.data.error); }
    }

    async function spinSlot() {
        const bet = document.getElementById('slot_bet').value;
        try {
            const res = await axios.post('/api/casino/slot', { bet });
            const reels = res.data.results;
            document.getElementById('r1').innerText = reels[0];
            document.getElementById('r2').innerText = reels[1];
            document.getElementById('r3').innerText = reels[2];
            setTimeout(() => alert(res.data.win > 0 ? res.data.win + "ì› ë‹¹ì²¨!" : "ê½!"), 100);
            setTimeout(() => location.reload(), 1000);
        } catch(e) { alert(e.response.data.error); }
    }
</script>
</body>
</html>
